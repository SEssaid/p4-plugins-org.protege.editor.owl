<?xml version = "1.0" encoding = "utf-8"?>
<project name = "owl" default = "compile" basedir = "..">
    <property name = "lib.dir"       location = "${owleditor.dir}/lib"/>
    <property name = "icons.dir"     location = "${owleditor.dir}/icons"/>
    <property name = "resources.dir" location = "${owleditor.dir}/resources"/>
    <property name = "src.dir"       location = "${owleditor.dir}/src"/>
    <property name = "junit.src.dir" location = "${owleditor.dir}/junit"/>
    
    <!-- =================================================================== -->
    <!-- Classpath declaration - used in the "compile" target -->
    <!-- =================================================================== -->
    <path id = "owleditor.classpath">    
        <path refid = "osgi.libs"/>
        <pathelement path="${commonlibs.jar}"/>
        <path refid="commonlibs.classpath"/>
        <pathelement location = "${core.jar}"/>
        <path refid="core.classpath"/>
        <path refid="owlapi.classpath"/>
    </path>

    <!-- =================================================================== -->
    <!-- INIT -->
    <!-- =================================================================== -->
    <target name = "init">
        <echo message="---------------Building the OWL Editor Plugin -------------"/>
        <tstamp/>
        <mkdir dir = "${owleditor.classes}"/>
    </target>  

    <!-- =================================================================== -->
    <!-- COMPILE -->
    <!-- =================================================================== -->
    <target name = "compile" depends = "init"> 
        <javac srcdir = "${src.dir}" 
               destdir = "${owleditor.classes}" 
               debug="${debug}" 
               source = "${source}" 
               includeAntRuntime = "${includeAntRuntime}">
            <classpath refid = "owleditor.classpath"/>
        </javac>
    </target>
    
    <!-- ===================================================================================== -->
    <!-- JAR - create the distribution JAR file that goes in the JPF "plugins" directory -->
    <!-- ===================================================================================== -->
    <target name = "bundle" depends = "compile">
        <copy todir="${owleditor.classes}">
            <fileset dir="${resources.dir}"/>
            <fileset dir="${icons.dir}"/>
        </copy>
        <copy todir="${owleditor.classes}" file="${owleditor.dir}/plugin.xml"/>
        <jar basedir = "${owleditor.classes}"
             destfile = "${owleditor.jar}"
             manifest="${owleditor.dir}/META-INF/MANIFEST.MF"/>
    </target>

    <!-- =================================================================== -->
    <!-- JUNIT -->
    <!-- =================================================================== -->

    <target name = "junit.compile">
        <javac srcdir = "${junit.src.dir}" 
               destdir = "${owleditor.classes}" 
               debug="${debug}" 
               source = "${source}" 
               includeAntRuntime = "${includeAntRuntime}">
            <classpath refid = "owleditor.classpath"/>
            <classpath>
                <pathelement location = "${junit.lib}"/>
            </classpath>
        </javac>
    </target>


    <target name = "junit" depends = "junit.compile">
        <junit printsummary="withOutAndErr"
               fork = "yes"
               dir = "${owleditor.dir}"
               filtertrace="yes"
               showoutput="yes"
               haltonfailure = "${junit.haltonfailure}"
               haltonerror = "${junit.haltonerror}">
            <jvmarg value="-Xmx${junit.memory}"/>
            <jvmarg value = "-Dlog4j.configuration=file:../../log4j-junit.xml"/>
            <classpath refid = "owleditor.classpath"/>
            <classpath>
                <pathelement location = "${junit.lib}"/>
                <pathelement location = "${owleditor.classes}"/>
            </classpath>
            <batchtest>
                <fileset dir="${owleditor.dir}/junit">
                    <include name = "**/*Test.java"/>
                </fileset>
            </batchtest>
        </junit>
    </target>

</project>
